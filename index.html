<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MDoces - Doceria Delivery</title>
  <style>
    /* Fonte */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap');

    :root {
      --azul-base: #011941;
      --azul-base-dark: #000f2a;
      --azul-base-light: #0a2a74;
      --white: #fff;
      --gray-light: #f5f5f5;
      --gray-dark: #555;
      --green: #25d366;
      --radius: 12px;
      --shadow: 0 4px 12px rgba(0,0,0,0.08);
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', sans-serif;
      background: var(--gray-light);
      margin: 0;
      color: #222;
      line-height: 1.4;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    header {
      background: var(--azul-base);
      color: var(--white);
      text-align: center;
      padding: 1.8rem 1rem 1.2rem;
      box-shadow: var(--shadow);
    }

    header h1 {
      margin-bottom: 0.3rem;
      font-weight: 700;
      font-size: 2rem;
      letter-spacing: 1px;
    }

    header p {
      font-weight: 400;
      font-size: 1rem;
      opacity: 0.85;
      margin-top: 0;
    }

    main.container {
      max-width: 960px;
      margin: 2rem auto;
      padding: 0 1rem;
      flex: 1;
      display: flex;
      gap: 2rem;
      flex-wrap: wrap;
    }

    /* Seções do site */
    #produtos {
      flex: 2 1 320px;
      display: grid;
      grid-template-columns: repeat(auto-fill,minmax(150px,1fr));
      gap: 1rem;
    }

    .produto-card {
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1rem;
      display: flex;
      flex-direction: column;
      cursor: pointer;
      transition: transform 0.2s ease;
    }

    .produto-card:hover,
    .produto-card:focus {
      transform: translateY(-5px);
      box-shadow: 0 6px 16px rgba(0,0,0,0.15);
      outline: none;
    }

    .produto-img {
      width: 100%;
      aspect-ratio: 1 / 1;
      object-fit: cover;
      border-radius: var(--radius);
      margin-bottom: 0.8rem;
    }

    .produto-nome {
      font-weight: 600;
      font-size: 1.1rem;
      margin-bottom: 0.3rem;
      color: var(--azul-base-dark);
    }

    .produto-descricao {
      flex-grow: 1;
      font-size: 0.9rem;
      color: var(--gray-dark);
      margin-bottom: 0.6rem;
      min-height: 38px;
    }

    .produto-preco {
      font-weight: 700;
      font-size: 1rem;
      color: var(--azul-base-light);
      margin-bottom: 0.5rem;
    }

    .btn-add {
      background: var(--azul-base-light);
      color: var(--white);
      border: none;
      border-radius: 6px;
      padding: 0.4rem;
      font-weight: 600;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }

    .btn-add:hover,
    .btn-add:focus {
      background: var(--azul-base-dark);
      outline: none;
    }

    /* Carrinho e formulário */
    #carrinho {
      flex: 1 1 320px;
      background: var(--white);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 1rem 1.5rem;
      display: flex;
      flex-direction: column;
      max-height: 600px;
      overflow-y: auto;
    }

    #carrinho h2 {
      margin-top: 0;
      margin-bottom: 1rem;
      color: var(--azul-base);
      font-weight: 700;
    }

    #itens-carrinho {
      list-style: none;
      padding-left: 0;
      flex-grow: 1;
      margin-bottom: 1rem;
      max-height: 280px;
      overflow-y: auto;
    }

    #itens-carrinho li {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0.3rem 0;
      border-bottom: 1px solid #eee;
    }

    #itens-carrinho li:last-child {
      border-bottom: none;
    }

    .item-info {
      flex: 1;
      font-size: 0.9rem;
      color: #444;
    }

    .item-quantidade {
      margin: 0 0.8rem;
    }

    .btn-remove-item {
      background: #e53935;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 700;
      padding: 0 8px;
      font-size: 1rem;
      line-height: 1;
      transition: background-color 0.2s ease;
    }

    .btn-remove-item:hover,
    .btn-remove-item:focus {
      background: #b71c1c;
      outline: none;
    }

    #total {
      font-weight: 700;
      font-size: 1.2rem;
      margin-bottom: 1rem;
      color: var(--azul-base-light);
      text-align: right;
    }

    form#form-pedido {
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
    }

    form#form-pedido label {
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--azul-base-dark);
    }

    form#form-pedido input,
    form#form-pedido select,
    form#form-pedido textarea {
      border: 1px solid #ccc;
      border-radius: 6px;
      padding: 0.5rem 0.6rem;
      font-size: 1rem;
      font-family: inherit;
      resize: vertical;
      transition: border-color 0.3s ease;
    }

    form#form-pedido input:focus,
    form#form-pedido select:focus,
    form#form-pedido textarea:focus {
      border-color: var(--azul-base-light);
      outline: none;
    }

    form#form-pedido button.btn-finalizar {
      background: var(--green);
      color: var(--white);
      font-weight: 700;
      border: none;
      border-radius: 6px;
      padding: 0.7rem;
      cursor: pointer;
      transition: background-color 0.3s ease;
      margin-top: 0.5rem;
    }

    form#form-pedido button.btn-finalizar:hover,
    form#form-pedido button.btn-finalizar:focus {
      background: #1ebe51;
      outline: none;
    }

    /* Status do pedido */
    #status-pedidos {
      max-width: 960px;
      margin: 1rem auto 3rem;
      padding: 0 1rem;
    }

    #status-pedidos h2 {
      color: var(--azul-base);
      font-weight: 700;
      margin-bottom: 1rem;
    }

    #lista-status-pedidos p {
      color: var(--gray-dark);
      font-style: italic;
    }

    /* Footer */
    footer {
      background: var(--azul-base);
      color: var(--white);
      text-align: center;
      padding: 1rem 0.5rem;
      font-size: 0.9rem;
      user-select: none;
      box-shadow: var(--shadow);
    }

    footer a.admin-link {
      display: inline-block;
      margin-top: 0.3rem;
      color: var(--green);
      font-weight: 600;
      text-decoration: none;
    }

    footer a.admin-link:hover,
    footer a.admin-link:focus {
      text-decoration: underline;
      outline: none;
    }

    /* Responsividade */
    @media (max-width: 720px) {
      main.container {
        flex-direction: column;
        margin: 1rem;
      }

      #produtos {
        grid-template-columns: repeat(auto-fill,minmax(140px,1fr));
        margin-bottom: 2rem;
      }

      #carrinho {
        max-height: none;
      }
    }
  </style>
</head>
<body>

<header>
  <h1>MDoces</h1>
  <p>Doceria Delivery - Os melhores doces direto para sua casa</p>
</header>

<main class="container">
  <section id="produtos" aria-label="Lista de produtos">
    <!-- Produtos serão inseridos aqui pelo JS -->
  </section>

  <aside id="carrinho" aria-label="Carrinho de compras">
    <h2>Carrinho</h2>
    <ul id="itens-carrinho" tabindex="0" aria-live="polite" aria-relevant="additions removals"></ul>
    <div id="total">Total: R$ 0,00</div>

    <form id="form-pedido" aria-label="Formulário para finalizar pedido">
      <label for="nome-cliente">Seu nome:</label>
      <input type="text" id="nome-cliente" name="nomeCliente" placeholder="Digite seu nome" required autocomplete="name" />

      <label for="endereco-cliente">Endereço para entrega:</label>
      <textarea id="endereco-cliente" name="enderecoCliente" placeholder="Rua, número, bairro, cidade..." rows="3" required autocomplete="street-address"></textarea>

      <button type="submit" class="btn-finalizar" aria-label="Finalizar pedido via WhatsApp">
        Finalizar pedido pelo WhatsApp
      </button>
    </form>
  </aside>
</main>

<section id="status-pedidos" aria-label="Status dos pedidos">
  <h2>Status dos pedidos recentes</h2>
  <div id="lista-status-pedidos">
    <p>Nenhum pedido realizado ainda.</p>
  </div>
</section>

<footer>
  Desenvolvido por MDoces &copy; 2025<br />
  <a href="admin.html" class="admin-link" aria-label="Área administrativa do MDoces">Área Administrativa</a>
</footer>

<script>
  // Dados iniciais - Exemplo de produtos
  const produtos = [
    {
      id: 'p1',
      nome: 'Brigadeiro Gourmet',
      descricao: 'Delicioso brigadeiro feito com chocolate belga.',
      preco: 5.50,
      imagem: 'https://i.imgur.com/4p1Rbsu.jpg',
      categoria: 'Brigadeiros'
    },
    {
      id: 'p2',
      nome: 'Beijinho',
      descricao: 'Beijinho macio com coco ralado.',
      preco: 4.50,
      imagem: 'https://i.imgur.com/jqF3kYX.jpg',
      categoria: 'Docinhos'
    },
    {
      id: 'p3',
      nome: 'Pé de Moleque',
      descricao: 'Doce crocante de amendoim e rapadura.',
      preco: 6.00,
      imagem: 'https://i.imgur.com/5A0C4Et.jpg',
      categoria: 'Doces tradicionais'
    },
    {
      id: 'p4',
      nome: 'Cajuzinho',
      descricao: 'Doce de amendoim com gostinho caseiro.',
      preco: 5.00,
      imagem: 'https://i.imgur.com/wH3kOJL.jpg',
      categoria: 'Docinhos'
    }
  ];

  // Variável para o carrinho (objeto idProduto: quantidade)
  let carrinho = JSON.parse(localStorage.getItem('mdoces_carrinho')) || {};
  let nomeCliente = localStorage.getItem('mdoces_nomeCliente') || '';
  let enderecoCliente = localStorage.getItem('mdoces_enderecoCliente') || '';
  let pedidos = JSON.parse(localStorage.getItem('mdoces_pedidos')) || [];

  const produtosContainer = document.getElementById('produtos');
  const itensCarrinhoUl = document.getElementById('itens-carrinho');
  const totalDiv = document.getElementById('total');
  const formPedido = document.getElementById('form-pedido');
  const inputNome = document.getElementById('nome-cliente');
  const inputEndereco = document.getElementById('endereco-cliente');
  const listaStatusPedidosDiv = document.getElementById('lista-status-pedidos');

  // Função para formatar preço em moeda BRL
  function formatarPreco(valor) {
    return valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
  }

  // Renderizar produtos na tela
  function renderizarProdutos() {
    produtosContainer.innerHTML = '';
    produtos.forEach(produto => {
      const card = document.createElement('article');
      card.className = 'produto-card';
      card.tabIndex = 0;
      card.setAttribute('role', 'button');
      card.setAttribute('aria-label', `${produto.nome} - ${formatarPreco(produto.preco)} - ${produto.descricao}`);

      card.innerHTML = `
        <img src="${produto.imagem}" alt="${produto.nome}" class="produto-img" loading="lazy" />
        <h3 class="produto-nome">${produto.nome}</h3>
        <p class="produto-descricao">${produto.descricao}</p>
        <div class="produto-preco">${formatarPreco(produto.preco)}</div>
        <button class="btn-add" aria-label="Adicionar ${produto.nome} ao carrinho">Adicionar</button>
      `;

      const btnAdd = card.querySelector('.btn-add');
      btnAdd.addEventListener('click', () => adicionarAoCarrinho(produto.id));

      card.addEventListener('keypress', e => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          adicionarAoCarrinho(produto.id);
        }
      });

      produtosContainer.appendChild(card);
    });
  }

  // Atualizar carrinho no localStorage
  function salvarCarrinho() {
    localStorage.setItem('mdoces_carrinho', JSON.stringify(carrinho));
  }

  // Atualizar pedidos no localStorage
  function salvarPedidos() {
    localStorage.setItem('mdoces_pedidos', JSON.stringify(pedidos));
  }

  // Renderizar carrinho
  function renderizarCarrinho() {
    itensCarrinhoUl.innerHTML = '';

    const ids = Object.keys(carrinho);
    if (ids.length === 0) {
      itensCarrinhoUl.innerHTML = '<li>O carrinho está vazio.</li>';
      totalDiv.textContent = 'Total: R$ 0,00';
      return;
    }

    let total = 0;
    ids.forEach(id => {
      const produto = produtos.find(p => p.id === id);
      const quantidade = carrinho[id];
      const subtotal = produto.preco * quantidade;
      total += subtotal;

      const li = document.createElement('li');

      li.innerHTML = `
        <span class="item-info">${produto.nome}</span>
        <button class="btn-remove-item" aria-label="Remover um ${produto.nome} do carrinho">-</button>
        <span class="item-quantidade" aria-live="polite">${quantidade}</span>
        <button class="btn-add" aria-label="Adicionar mais um ${produto.nome} ao carrinho">+</button>
        <span class="item-info">${formatarPreco(subtotal)}</span>
      `;

      const btnRemover = li.querySelector('.btn-remove-item');
      const btnAdicionar = li.querySelector('.btn-add');

      btnRemover.addEventListener('click', () => {
        diminuirQuantidade(id);
      });
      btnAdicionar.addEventListener('click', () => {
        adicionarAoCarrinho(id);
      });

      itensCarrinhoUl.appendChild(li);
    });

    totalDiv.textContent = `Total: ${formatarPreco(total)}`;
  }

  // Adicionar produto ao carrinho
  function adicionarAoCarrinho(id) {
    carrinho[id] = (carrinho[id] || 0) + 1;
    salvarCarrinho();
    renderizarCarrinho();
  }

  // Diminuir quantidade do produto no carrinho
  function diminuirQuantidade(id) {
    if (!carrinho[id]) return;
    carrinho[id] -= 1;
    if (carrinho[id] <= 0) {
      delete carrinho[id];
    }
    salvarCarrinho();
    renderizarCarrinho();
  }

  // Carregar nome e endereço do cliente no formulário
  function carregarDadosCliente() {
    if (nomeCliente) inputNome.value = nomeCliente;
    if (enderecoCliente) inputEndereco.value = enderecoCliente;
  }

  // Salvar dados do cliente no localStorage
  function salvarDadosCliente() {
    nomeCliente = inputNome.value.trim();
    enderecoCliente = inputEndereco.value.trim();
    localStorage.setItem('mdoces_nomeCliente', nomeCliente);
    localStorage.setItem('mdoces_enderecoCliente', enderecoCliente);
  }

  // Montar mensagem do pedido para WhatsApp
  function montarMensagemWhatsApp() {
    if (!nomeCliente || !enderecoCliente) {
      alert('Por favor, preencha seu nome e endereço para finalizar o pedido.');
      return null;
    }

    const linhas = [];
    linhas.push(`*Pedido de ${nomeCliente}*`);
    linhas.push('');
    linhas.push('Itens:');

    let total = 0;
    for (const id in carrinho) {
      const produto = produtos.find(p => p.id === id);
      const qtd = carrinho[id];
      const subtotal = produto.preco * qtd;
      total += subtotal;
      linhas.push(`- ${produto.nome} x${qtd} = ${formatarPreco(subtotal)}`);
    }

    linhas.push('');
    linhas.push(`*Total: ${formatarPreco(total)}*`);
    linhas.push('');
    linhas.push('Endereço para entrega:');
    linhas.push(enderecoCliente);
    linhas.push('');
    linhas.push('Por favor, confirmar o pedido.');

    return encodeURIComponent(linhas.join('\n'));
  }

  // Enviar pedido via WhatsApp
  function enviarPedidoWhatsApp() {
    const numeroWhatsApp = localStorage.getItem('mdoces_numeroWhatsApp') || '5511999999999'; // Número padrão

    const mensagem = montarMensagemWhatsApp();
    if (!mensagem) return;

    // Salvar pedido no histórico local
    const pedido = {
      id: Date.now(),
      nomeCliente,
      enderecoCliente,
      itens: { ...carrinho },
      total: Object.entries(carrinho).reduce((acc, [id, qtd]) => {
        const p = produtos.find(prod => prod.id === id);
        return acc + p.preco * qtd;
      }, 0),
      data: new Date().toISOString(),
      status: 'Pedido enviado'
    };

    pedidos.push(pedido);
    salvarPedidos();

    // Limpar carrinho
    carrinho = {};
    salvarCarrinho();
    renderizarCarrinho();

    // Atualizar lista de status dos pedidos
    renderizarStatusPedidos();

    // Abrir WhatsApp Web com mensagem
    window.open(`https://wa.me/${numeroWhatsApp}?text=${mensagem}`, '_blank');
  }

  // Renderizar status dos pedidos
  function renderizarStatusPedidos() {
    listaStatusPedidosDiv.innerHTML = '';
    if (pedidos.length === 0) {
      listaStatusPedidosDiv.innerHTML = '<p>Nenhum pedido realizado ainda.</p>';
      return;
    }

    // Mostrar os 5 pedidos mais recentes
    const recentes = pedidos.slice(-5).reverse();

    recentes.forEach(pedido => {
      const div = document.createElement('div');
      div.style.borderBottom = '1px solid #ccc';
      div.style.padding = '0.4rem 0';

      const dataFormatada = new Date(pedido.data).toLocaleString('pt-BR', {
        dateStyle: 'short',
        timeStyle: 'short'
      });

      div.innerHTML = `
        <strong>${pedido.nomeCliente}</strong> - ${dataFormatada} <br/>
        Status: <em>${pedido.status}</em> <br/>
        Total: ${formatarPreco(pedido.total)}
      `;
      listaStatusPedidosDiv.appendChild(div);
    });
  }

  // Evento submit do formulário
  formPedido.addEventListener('submit', e => {
    e.preventDefault();
    salvarDadosCliente();
    if (Object.keys(carrinho).length === 0) {
      alert('Seu carrinho está vazio.');
      return;
    }
    enviarPedidoWhatsApp();
  });

  // Inicialização
  function inicializar() {
    renderizarProdutos();
    renderizarCarrinho();
    carregarDadosCliente();
    renderizarStatusPedidos();
  }

  inicializar();

</script>

</body>
</html>
