<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Admin MDoces - Login</title>
<style>
  body {
    font-family: Arial, sans-serif;
    background: #1e40af; /* azul índigo */
    color: white;
    margin: 0;
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
  }
  #login-container, #admin-container {
    background: #1e40af;
    padding: 20px;
    border-radius: 8px;
    width: 95%;
    max-width: 400px;
    box-shadow: 0 0 15px rgba(0,0,0,0.3);
  }
  h2 {
    text-align: center;
    margin-bottom: 15px;
  }
  label {
    display: block;
    margin: 10px 0 5px;
  }
  input[type=password], input[type=text], input[type=number], select {
    width: 100%;
    padding: 8px;
    border-radius: 4px;
    border: none;
  }
  button {
    margin-top: 15px;
    width: 100%;
    padding: 10px;
    background: #2563eb; /* azul claro */
    border: none;
    color: white;
    font-size: 1rem;
    border-radius: 5px;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button:hover {
    background: #1d4ed8;
  }
  #logout-btn {
    background: #dc2626;
    margin-top: 10px;
  }
  .hidden {
    display: none;
  }
  .product-list, .pedido-list {
    max-height: 300px;
    overflow-y: auto;
    margin-top: 15px;
    background: #2563eb;
    padding: 10px;
    border-radius: 6px;
  }
  .product-item, .pedido-item {
    background: #3b82f6;
    margin-bottom: 8px;
    padding: 8px;
    border-radius: 6px;
  }
  .product-item:last-child, .pedido-item:last-child {
    margin-bottom: 0;
  }
  .flex-row {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .flex-grow {
    flex-grow: 1;
  }
  .small-btn {
    background: #ef4444;
    border: none;
    color: white;
    border-radius: 4px;
    cursor: pointer;
    padding: 4px 8px;
    font-size: 0.9rem;
    transition: background 0.3s ease;
  }
  .small-btn:hover {
    background: #b91c1c;
  }
  label[for="img-url"] {
    font-size: 0.9rem;
  }
  img.product-thumb {
    max-width: 50px;
    max-height: 50px;
    object-fit: cover;
    border-radius: 5px;
    margin-right: 8px;
  }
  select {
    padding: 6px;
  }
  .pedido-status-select {
    margin-top: 5px;
    width: 100%;
    padding: 6px;
    border-radius: 4px;
    border: none;
  }
  @media (max-width: 500px) {
    #login-container, #admin-container {
      max-width: 100%;
    }
  }
</style>
</head>
<body>

<div id="login-container">
  <h2>Login Admin MDoces</h2>
  <label for="admin-password">Senha:</label>
  <input type="password" id="admin-password" placeholder="Digite a senha" />
  <button id="btn-login">Entrar</button>
  <p style="margin-top:15px; font-size: 0.85rem; color: #a5b4fc;">Senha padrão: <strong>mdoces123</strong></p>
</div>

<div id="admin-container" class="hidden">
  <h2>Administração MDoces</h2>
  <button id="logout-btn">Sair</button>

  <section id="produtos-section">
    <h3>Gerenciar Produtos</h3>
    <form id="produto-form">
      <input type="hidden" id="produto-id" />
      <label for="produto-nome">Nome</label>
      <input type="text" id="produto-nome" required />
      <label for="produto-descricao">Descrição</label>
      <input type="text" id="produto-descricao" />
      <label for="produto-preco">Preço (R$)</label>
      <input type="number" id="produto-preco" step="0.01" min="0" required />
      <label for="produto-categoria">Categoria</label>
      <select id="produto-categoria" required>
        <option value="">Selecione...</option>
        <option value="Doces">Doces</option>
        <option value="Bolos">Bolos</option>
        <option value="Salgados">Salgados</option>
        <option value="Bebidas">Bebidas</option>
      </select>
      <label for="produto-img-url">URL da Imagem</label>
      <input type="text" id="produto-img-url" placeholder="https://..." />
      <button type="submit" id="btn-salvar-produto">Salvar Produto</button>
      <button type="button" id="btn-limpar-form" style="background:#2563eb; margin-top:5px;">Limpar Formulário</button>
    </form>
    <div class="product-list" id="lista-produtos"></div>
  </section>

  <section id="pedidos-section" style="margin-top: 30px;">
    <h3>Gerenciar Pedidos</h3>
    <div class="pedido-list" id="lista-pedidos"></div>
  </section>
</div>

<script>
  const senhaAdmin = 'mdoces123'; // senha simples para demo
  const loginContainer = document.getElementById('login-container');
  const adminContainer = document.getElementById('admin-container');
  const btnLogin = document.getElementById('btn-login');
  const logoutBtn = document.getElementById('logout-btn');

  const produtoForm = document.getElementById('produto-form');
  const inputProdutoId = document.getElementById('produto-id');
  const inputNome = document.getElementById('produto-nome');
  const inputDescricao = document.getElementById('produto-descricao');
  const inputPreco = document.getElementById('produto-preco');
  const selectCategoria = document.getElementById('produto-categoria');
  const inputImgUrl = document.getElementById('produto-img-url');
  const btnLimparForm = document.getElementById('btn-limpar-form');

  const listaProdutosDiv = document.getElementById('lista-produtos');
  const listaPedidosDiv = document.getElementById('lista-pedidos');

  let produtos = [];
  let pedidos = [];

  // Verifica se admin está logado
  function checkLogin() {
    const logado = localStorage.getItem('mdoces-admin-logado');
    if (logado === 'true') {
      loginContainer.classList.add('hidden');
      adminContainer.classList.remove('hidden');
      carregarProdutos();
      carregarPedidos();
      renderProdutos();
      renderPedidos();
    } else {
      loginContainer.classList.remove('hidden');
      adminContainer.classList.add('hidden');
    }
  }

  // Login
  btnLogin.addEventListener('click', () => {
    const senha = document.getElementById('admin-password').value;
    if (senha === senhaAdmin) {
      localStorage.setItem('mdoces-admin-logado', 'true');
      checkLogin();
    } else {
      alert('Senha incorreta!');
    }
  });

  // Logout
  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('mdoces-admin-logado');
    checkLogin();
  });

  // Carregar produtos do localStorage
  function carregarProdutos() {
    const dados = localStorage.getItem('mdoces-produtos');
    if (dados) {
      produtos = JSON.parse(dados);
    } else {
      produtos = [];
      salvarProdutos();
    }
  }

  // Salvar produtos no localStorage
  function salvarProdutos() {
    localStorage.setItem('mdoces-produtos', JSON.stringify(produtos));
  }

  // Renderizar lista de produtos
  function renderProdutos() {
    listaProdutosDiv.innerHTML = '';
    if (produtos.length === 0) {
      listaProdutosDiv.innerHTML = '<p>Nenhum produto cadastrado.</p>';
      return;
    }
    produtos.forEach(prod => {
      const div = document.createElement('div');
      div.className = 'product-item flex-row';
      div.innerHTML = `
        <img src="${prod.imagem || 'https://via.placeholder.com/50'}" alt="${prod.nome}" class="product-thumb" />
        <div class="flex-grow">
          <strong>${prod.nome}</strong> <br />
          R$ ${prod.preco.toFixed(2)} - <em>${prod.categoria}</em><br />
          ${prod.descricao || ''}
        </div>
        <button class="small-btn" data-id="${prod.id}" data-action="editar">Editar</button>
        <button class="small-btn" data-id="${prod.id}" data-action="excluir">Excluir</button>
      `;
      listaProdutosDiv.appendChild(div);
    });
  }

  // Editar produto
  listaProdutosDiv.addEventListener('click', (e) => {
    const btn = e.target.closest('button');
    if (!btn) return;

    const id = btn.getAttribute('data-id');
    const action = btn.getAttribute('data-action');
    if (action === 'editar') {
      const prod = produtos.find(p => p.id === id);
      if (!prod) return;
      inputProdutoId.value = prod.id;
      inputNome.value = prod.nome;
      inputDescricao.value = prod.descricao || '';
      inputPreco.value = prod.preco;
      selectCategoria.value = prod.categoria;
      inputImgUrl.value = prod.imagem || '';
    }
    if (action === 'excluir') {
      if (confirm('Confirma exclusão do produto?')) {
        produtos = produtos.filter(p => p.id !== id);
        salvarProdutos();
        renderProdutos();
      }
    }
  });

  // Limpar formulário
  btnLimparForm.addEventListener('click', () => {
    limparFormularioProduto();
  });

  function limparFormularioProduto() {
    inputProdutoId.value = '';
    inputNome.value = '';
    inputDescricao.value = '';
    inputPreco.value = '';
    selectCategoria.value = '';
    inputImgUrl.value = '';
  }

  // Salvar produto (novo ou editado)
  produtoForm.addEventListener('submit', (e) => {
    e.preventDefault();
    const id = inputProdutoId.value;
    const nome = inputNome.value.trim();
    const descricao = inputDescricao.value.trim();
    const preco = parseFloat(inputPreco.value);
    const categoria = selectCategoria.value;
    const imagem = inputImgUrl.value.trim();

    if (!nome || !categoria || isNaN(preco)) {
      alert('Preencha nome, categoria e preço corretamente.');
      return;
    }

    if (id) {
      // Editar
      const idx = produtos.findIndex(p => p.id === id);
      if (idx >= 0) {
        produtos[idx] = { id, nome, descricao, preco, categoria, imagem };
      }
    } else {
      // Novo
      const novoId = 'p' + Date.now();
      produtos.push({ id: novoId, nome, descricao, preco, categoria, imagem });
    }
    salvarProdutos();
    renderProdutos();
    limparFormularioProduto();
  });

  // --- Pedidos ---

  // Carregar pedidos do localStorage
  function carregarPedidos() {
    const dados = localStorage.getItem('mdoces-pedidos');
    if (dados) {
      pedidos = JSON.parse(dados);
    } else {
      pedidos = [];
      salvarPedidos();
    }
  }

  // Salvar pedidos no localStorage
  function salvarPedidos() {
    localStorage.setItem('mdoces-pedidos', JSON.stringify(pedidos));
  }

  // Renderizar pedidos
  function renderPedidos() {
    listaPedidosDiv.innerHTML = '';
    if (pedidos.length === 0) {
      listaPedidosDiv.innerHTML = '<p>Nenhum pedido realizado.</p>';
      return;
    }

    pedidos.forEach(pedido => {
      const div = document.createElement('div');
      div.className = 'pedido-item';

      // Produtos texto
      let produtosTexto = pedido.produtos.map(item => {
        return `${item.nome} x${item.quantidade}`;
      }).join(', ');

      div.innerHTML = `
        <p><strong>Pedido:</strong> ${pedido.id}</p>
        <p><strong>Cliente:</strong> ${pedido.cliente}</p>
        <p><strong>Produtos:</strong> ${produtosTexto}</p>
        <p><strong>Endereço:</strong> ${pedido.endereco}</p>
        <p><strong>Pagamento:</strong> ${pedido.formaPagamento}</p>
        <p><strong>Observações:</strong> ${pedido.observacoes || '-'}</p>
        <p><strong>Data:</strong> ${new Date(pedido.dataHora).toLocaleString('pt-BR')}</p>
        <label for="status-${pedido.id}">Status:</label>
        <select class="pedido-status-select" id="status-${pedido.id}" data-id="${pedido.id}">
          <option value="0" ${pedido.status === 0 ? 'selected' : ''}>Pedido Recebido</option>
          <option value="1" ${pedido.status === 1 ? 'selected' : ''}>Em Preparo</option>
          <option value="2" ${pedido.status === 2 ? 'selected' : ''}>Saiu para Entrega</option>
          <option value="3" ${pedido.status === 3 ? 'selected' : ''}>Entregue</option>
        </select>
      `;

      listaPedidosDiv.appendChild(div);
    });
  }

  // Alterar status pedido
  listaPedidosDiv.addEventListener('change', (e) => {
    if (e.target.classList.contains('pedido-status-select')) {
      const id = e.target.getAttribute('data-id');
      const novoStatus = parseInt(e.target.value);
      const idx = pedidos.findIndex(p => p.id === id);
      if (idx >= 0) {
        pedidos[idx].status = novoStatus;
        salvarPedidos();
        alert('Status atualizado!');
      }
    }
  });

  // Inicialização
  checkLogin();

</script>
</body>
</html>
